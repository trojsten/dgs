\makeatletter

% Fix bug in pandoc
\providecommand{\tightlist}{}

% Render percent sign with nice font, not ugly Computer modern
\mathcode`\%="7025
\DeclareRobustCommand{\%}{\text{\symbol{`\%}}}

\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother

\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}

% Force float placement for figures to H
\floatplacement{figure}{H}

\newcommand\invisiblesubsection[1]{%
    \refstepcounter{subsection}%
    \addcontentsline{toc}{subsection}{\protect\numberline{\thesubsection}#1}%
    \subsectionmark{#1}%
}

% Fix chemfig's collision with babel where -- is interpreted before chemfig
\pretocmd\schemestart{\shorthandoff{-}}{}{}
\apptocmd\schemestop{\shorthandon{-}}{}{}

\usetikzlibrary{decorations.markings}
\setchemfig{
    atom sep=8mm,
    bond style={line width=1pt},
    schemestart code=\chemnameinit{},
}
\tikzset{
  over line/.style={
    white,
    double=black,
    double distance=\the\pgflinewidth,
    line width=1.5pt,
  },
  under line/.style={
    decoration={
      markings,
      mark connection node=mid node,
      mark=at position #1 with {}
      {\node[transform shape,minimum size=3pt] (mid node) {};}
    },
    decorate
  }
}

\usepackage{tikz,stackengine}
\usepackage{graphicx}
\usepackage{chemfig}
\usepackage{mhchem}
\setstackEOL{\\}

\NewDocumentCommand{\JigsawSide}{m}{
    (0.5,0.5) --
    (0.0,#1*0.00) .. controls (0.0,#1*0.00) and (0.4,#1*-0.04) ..
    (0.4,#1*0.04) .. controls (0.4,#1*0.11) and (0.2,#1*0.26) ..
    (0.5,#1*0.26) .. controls (0.8,#1*0.26) and (0.6,#1*0.11) ..
    (0.6,#1*0.04) .. controls (0.6,#1*-0.04) and (1.0,#1*0.00) ..
    (1.0,#1*0.00)
}
\NewDocumentCommand{\JigsawPiece}{O{white} m m m m m}{
    \draw[#1,postaction={fill=white}]
    \JigsawSide{#2}[rotate around={90:(0.5,0.5)}]
    \JigsawSide{#3}[rotate around={180:(0.5,0.5)}]
    \JigsawSide{#4}[rotate around={270:(0.5,0.5)}]
    \JigsawSide{#5} -- cycle;
    \node [black] at (.5,.5) {\Centerstack{#6}};
}
