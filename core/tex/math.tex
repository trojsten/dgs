\DeclareMathOperator{\diff}{d\!}
\DeclareMathOperator{\pdiff}{\partial\!}
\DeclareMathOperator{\fdiff}{\Delta\!}
\DeclareMathOperator{\sdiff}{\delta\!}
\DeclareMathOperator{\laplacian}{\Delta\!}
\DeclareMathOperator{\del}{\raisebox{0.06em}{\ensuremath{\vec{\nabla}}}}
\DeclareMathOperator{\Div}{\del\cdot}
\DeclareMathOperator{\Rot}{\del\times}

\DeclareMathOperator{\atantwo}{atan2}

\DeclareMathOperator{\maxop}{max\ }
\DeclareMathOperator{\minop}{min\ }

\DeclareMathOperator{\LXor}{\quad\lxor\quad}
\DeclareMathOperator{\LOr}{\quad\lor\quad}
\DeclareMathOperator{\LAnd}{\quad\land\quad}
\DeclareMathOperator{\LNand}{\quad\lnand\quad}

\DeclareMathOperator{\sinc}{sinc}
\DeclareMathOperator{\hav}{hav}

\NewDocumentCommand{\Diff}{O{}}{\diff^{\,#1}\!}

% \Derivative[order]{what}{by-what}
\NewDocumentCommand{\Derivative}{O{} m m}{%
    \IfNoValueTF{#1}{%
        \frac{\diff#2}{\diff#3}%
    }{%
        \frac{\diff^{\,{#1}}\!{#2}}{\diff{#3}^{#1}}%
    }%
}%

% \DerivativeEmpty[order]{by-what}
\NewDocumentCommand{\DerivativeE}{O{} m}{%
    \IfNoValueTF{#1}{%
        \frac{\diff}{\diff#2}%
    }{%
        \frac{\diff^{\,{#1}}}{\diff{#2}^{\,#1}}%
    }%
}%

% \DerivativeParentheses{what}{by-what}
\NewDocumentCommand{\DerivativeParen}{O{} m m}{%
    \IfNoValueTF{#1}{%
        \frac{\diff}{\diff#2}\left(#3\right)%
    }{%
        \frac{\diff^{#1}}{\diff #2^{#1}}\left(#3\right)%
    }%
}%

% \DerivativeEvaluate[order]{what}{by-what}{where}
% \DerivativeEval[2]{f(x)}{x}{0} is second derivative of f(x) at x = 0
\NewDocumentCommand{\DerivativeEval}{O{} m m m}{%
    \EvalAt{\Derivative[#1]{#2}{#3}}{#3 = #4}%
}%

% \PartialDerivative[order]{what}{by-what}
\NewDocumentCommand{\PDerivative}{O{} m m}{%
    \IfNoValueTF{#1}{%
        \frac{\partial#2}{\partial#3}%
    }{%
        \frac{\partial^{#1}\!{#2}}{\pdiff{#3}^{#1}}%
    }%
}%

% \PartialDerivativeEmpty[order]{by-what}
\NewDocumentCommand{\PDerivativeE}{O{} m}{%
    \IfNoValueTF{#1}{%
        \frac{\pdiff}{\pdiff#2}%
    }{%
        \frac{\pdiff^{\,{#1}}}{\pdiff{#2}^{\,#1}}%
    }%
}%

% \PartialDerivativeParentheses{what}{by-what}
\NewDocumentCommand{\PDerivativeParen}{O{} m m}{%
    \IfNoValueTF{#1}{%
        \frac{\pdiff}{\pdiff#3}\left(#2\right)%
    }{%
        \frac{\pdiff^{#1}}{\pdiff #3^{#1}}\left(#2\right)%
    }%
}%

% \PartialDerivativeEvaluate[order]{what}{by-what}{where}
% \PDerivativeEval[2]{f(x)}{x}{0} is second derivative of f(x) at x = 0
\NewDocumentCommand{\PDerivativeEval}{O{} m m m}{%
    \EvalAt{\PDerivative[#1]{#2}{#3}}{#3 = #4}%
}%

\NewDocumentCommand{\ArrowVector}{m}{\vv{#1}}
\NewDocumentCommand{\BoldVector}{m}{\mathbf{#1}}
\NewDocumentCommand{\UnitVector}{m}{\hat{\vec{#1}}}

\NewDocumentCommand{\EvalAt}{m m}{\left.#1\right|_{#2}}
\NewDocumentCommand{\EvalFromTo}{m m m}{\left.#1\right|_{#2}^{#3}}
\NewDocumentCommand{\ExpectedChevrons}{m}{\left<#1\right>}
\NewDocumentCommand{\ExpectedE}{m}{\mathbb{E}\left[#1\right]}
\NewDocumentCommand{\Mean}{m}{\overline{#1}}

%\NewDocumentCommand{\Int}{O{} O{} m m}{\int\limits_{#1}^{#2} \kern -0.2em #3\diff#4}
\NewDocumentCommand{\Int}{O{} O{} m O{} m}{\int\limits_{#1}^{#2} \kern -0.2em #3#4\diff#5}
\NewDocumentCommand{\IntDot}{O{} O{} m m}{\int\limits_{#1}^{#2} \kern -0.2em #3\cdot\diff#4}
\NewDocumentCommand{\IntCross}{O{} O{} m m}{\int\limits_{#1}^{#2} \kern -0.2em #3\cross\diff#4}
\NewDocumentCommand{\Intx}{O{} O{} m}{\int\limits_{#1}^{#2} \kern -0.2em #3}
\NewDocumentCommand{\OInt}{O{} O{} m m}{\oint\limits_{#1}^{#2} \kern -0.2em#3\diff#4}
\NewDocumentCommand{\OIntDot}{O{} O{} m m}{\oint\limits_{#1}^{#2} \kern -0.2em#3\cdot\diff#4}
\NewDocumentCommand{\OIntCross}{O{} O{} m m}{\oint\limits_{#1}^{#2} \kern -0.2em#3\cross\diff#4}
\NewDocumentCommand{\IInt}{O{} O{} m m m}{\iint\limits_{#1}^{\quad#2} #3 \diff#4\diff#5}
\NewDocumentCommand{\OIInt}{O{} O{} m m}{\oiint\limits_{#1}^{\quad#2} #3 \diff#4}
\NewDocumentCommand{\IIInt}{O{} O{} m m m m}{\iiint\limits_{#1}^{#2} #3 \diff#4\diff#5\diff#6}

\NewDocumentCommand{\QText}{m}{\quad\text{#1}\quad}
\NewDocumentCommand{\QQText}{m}{\qquad\text{#1}\qquad}

\NewDocumentCommand{\Floor}{m}{\left\lfloor#1\right\rfloor}
\NewDocumentCommand{\Ceil}{m}{\left\lceil#1\right\rceil}

\NewDocumentCommand{\Lim}{m m}{\lim\limits_{#1 \rightarrow #2}}
\NewDocumentCommand{\Exp}{m}{e^{#1}}
\NewDocumentCommand{\LogTen}{}{\log_{10}}
\NewDocumentCommand{\MustEqual}{}{\stackrel{!}{=}}
\NewDocumentCommand{\DefEqual}{}{\stackrel{\mathrm{def}}{=}}
\NewDocumentCommand{\Implies}{}{\quad\Rightarrow\quad}
\NewDocumentCommand{\Iff}{}{\quad\Leftrightarrow\quad}

\NewDocumentCommand{\Nuclide}{O{} O{} m}{\ce{^{#1}_{#2}#3}}

\NewDocumentCommand{\Sum}{O{} O{} m}{\sum\limits_{#1}^{#2} {#3}}
\NewDocumentCommand{\Product}{O{} O{} m}{\prod\limits_{#1}^{#2} #3}
\NewDocumentCommand{\CartesianProduct}{O{} O{} m}{\bigtimes\limits_{#1}^{#2} #3}
\NewDocumentCommand{\Abs}{m}{\left|#1\right|}
\NewDocumentCommand{\Max}{O{} m}{\underset{#1}{\maxop} {#2}}
\NewDocumentCommand{\Min}{O{} m}{\underset{#1}{\minop} {#2}}

\NewDocumentCommand{\Angle}{}{\sphericalangle}

\NewDocumentCommand{\Mag}{m}{\ensuremath{{#1}^{\mathrm{m}}}}
\NewDocumentCommand{\Distribution}{m m m}{#1(#2 \vert #3)}

\NewDocumentCommand{\SmallO}{m}{\mathcal{o}\left(#1\right)}
\NewDocumentCommand{\BigO}{m}{\mathcal{O}\left(#1\right)}
\NewDocumentCommand{\BigTheta}{m}{\mathcal{\Theta}\left(#1\right)}

\NewDocumentCommand{\Set}{m O{} O{}}{%
    \left\{#1\right\}\IfNoValueTF{#2}{}{_{#2}}\IfNoValueTF{#3}{}{^{#3}}%
}

% Number sets
\NewDocumentCommand{\Natural}{}{\mathbb{N}}
\NewDocumentCommand{\NaturalZero}{}{\mathbb{N}_0}
\NewDocumentCommand{\Integer}{}{\mathbb{Z}}
\NewDocumentCommand{\Rational}{}{\mathbb{Q}}
\NewDocumentCommand{\Real}{}{\mathbb{R}}
\NewDocumentCommand{\RealPos}{}{\mathbb{R}^{+}}
\NewDocumentCommand{\RealNonneg}{}{\mathbb{R}_{\geq 0}}
\NewDocumentCommand{\Complex}{}{\mathbb{C}}

% Functions
\NewDocumentCommand{\Domain}{m}{\mathrm{dom}(#1)}

% Matrices
\NewDocumentCommand{\mat}{m}{\symbf{#1}}
\NewDocumentCommand{\Transpose}{m}{#1^{\mathsf{T}}}
\NewDocumentCommand{\Inv}{m}{#1^{-1}}
\NewDocumentCommand{\Det}{m}{\left|#1\right|}
\NewDocumentCommand{\Eye}{}{\mathbb{I}}

% Intervals
\NewDocumentCommand{\IntervalCC}{m m}{\left[#1; #2\right]}
\NewDocumentCommand{\IntervalCO}{m m}{\left[#1; #2\right)}
\NewDocumentCommand{\IntervalOC}{m m}{\left(#1; #2\right]}
\NewDocumentCommand{\IntervalOO}{m m}{\left(#1; #2\right)}

\NewDocumentCommand{\kth}{m}{\ensuremath{#1^{\text{th}}}}

% Fix weird font choices
\let\tmp\phi
\let\phi\varphi
\let\varphi\tmp
\let\tmp\epsilon
\let\epsilon\varepsilon
\let\varepsilon\tmp

% Patch \left and \right with package mleftright
\let\left\mleft
\let\right\mright
